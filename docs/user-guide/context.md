---
layout: docs
toc: user-guide-toc.html
title: コンテキストを利用する
---

 - [コンテキストとは](#コンテキストとは)
 - [コンテキストスコープ](#コンテキストスコープ)
 - [コンテキストに保管する](#コンテキストに保管する)
 - [フローでコンテキストを利用する](#フローでコンテキストを利用する)
 - [Functionノードでコンテキストを利用する](#functionノードでコンテキストを利用する)
 - [カスタムノードでコンテキストを利用する](#カスタムノードでコンテキストを利用する)

### コンテキストとは？

Node-REDは、フローで受け渡すメッセージを利用せずに異なるノード間で共有する情報を保管する方法を提供しています。
これは「コンテキスト」と呼ばれます。

### コンテキストスコープ

特定のコンテキスト値の「スコープ」によって、誰と共有されるかが決定されます。
コンテキストスコープには3つのレベルが存在します。:

 - ノード - 値を設定したノードのみアクセスできます
 - フロー - 同じフロー（またはエディタのタブ）のすべてのノードがアクセスできます
 - グローバル - すべてのノードがアクセスできます

特定の値のスコープの選択は、その値がどのように利用されるかに依ります。

もし値が単一のノードからのアクセスだけで足りる場合、例えばFunctionノードなどの場合、
ノードコンテキストで充分です。

しばしば、コンテキストはある種の状態を複数のノード間で共有することができます。
例えば、センサーは定期的に1つのフローに値を送出しており、
最新の値を返却するために別のHTTPトリガーフローを作成したいかもしれません。
センサーの測定値をコンテキストに格納することで、HTTPフローが戻ることが可能になります。

設定ファイルの`functionGlobalContext`プロパティを利用することで、
グローバルコンテキストに事前に値を設定することができます。

<div class="doc-callout"><em>Note</em> : サブフロー内のノードにとって、
「フロー」コンテキストはサブフローの範囲になります。
これらのノードは、サブフローインスタンスノードを含むフローのフローコンテキストにアクセスすることはできません。</div>


### コンテキストに保管する

デフォルトでは、コンテキストはメモリのみに保存されます。
つまり、Node-REDが再起動するたびにコンテキストの内容はクリアされます。
0.19版リリースによって、コンテキストデータを保存するようにNode-REDを設定することが可能になり、再起動後も利用できるようになりました。

setting.jsの`contextStorage`プロパティは、
コンテキストデータがどのように保管されるかを設定するために利用できます。

例えば、ファイルに基づいた記憶領域を利用するためには、以下のオプションが利用できます。:

{% highlight javascript %}
contextStorage: {
   default: {
       module: "localfilesystem"
   }
}
{% endhighlight %}

Node-REDは、`memory`および`localfilesystem`という2つの組込みストアモジュールを提供しています。
また、カスタムストアプラグインを作成することも可能です。

組込みモジュールのすべての詳細情報およびカスタムモジュールの作成方法については、
[APIのページ](../api/context/)で確認することができます。

ストアは同期または非同期なアクセスを提供できます。
同期アクセスとは、ストアからデータを取得するための呼び出しが値とともにすぐに返却されることを意味します。
非同期アクセスは、データを取得するための呼び出しがコールバック関数を提供し、
この関数は値が利用可能になった後に呼び出されます。

組込みストアである`memory`および`file`は両者ともに同期アクセスを提供します。
つまり、現在（0.19版以前）のフローを変更せずにこれらのストアを利用できます。

### フローでコンテキストを利用する

コンテキストに値を設定する最も簡単な方法は、Changeノードを使用することです。
例えば、以下のようなChangeノードのルールによって、
`msg.payload`の値を`flow`コンテキストに`myData`というキーで保管します。

<div style="text-align: center"><img src="/docs/user-guide/images/context_change.png" width="488px"></div>

様々なノードで直接コンテキストにアクセスすることができます。
例えば、Injectノードはコンテキスト値を注入するように設定することができ、
Switchノードはコンテキストに保管された値をもとにメッセージをルーティングすることができます。

### Functionノードでコンテキストを利用する

[Functionノードの書き方ガイド](../writing-functions#storing-data)に、
Functionノードでのコンテキストの使い方が記述されています。

### カスタムノードでコンテキストを利用する

[ノードの開発ガイド](/docs/creating-nodes/context)にカスタムノードでのコンテキストの使い方が記述されています。
