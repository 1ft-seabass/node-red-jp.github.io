<!DOCTYPE html>
<html lang="ja"><head>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Node-RED日本ユーザ会  : Running under Docker</title>

	<link href='https://fonts.googleapis.com/css?family=Roboto+Slab:400,700,300,100' rel='stylesheet' type='text/css'>
	<link href='https://fonts.googleapis.com/css?family=Ubuntu+Mono' rel='stylesheet' type='text/css'>
	<link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">

    <script src="/jquery/js/jquery-1.9.1.js"></script>
	<link href="/css/simplegrid.css" rel="stylesheet" media="screen">
	<link href="/css/style.css" rel="stylesheet" media="screen">
	<link href="/css/front.css" rel="stylesheet" media="screen">
	<link href="/css/docs.css" rel="stylesheet" media="screen">
	<link href="/css/blog.css" rel="stylesheet" media="screen">
	<link href="/css/syntax.css" rel="stylesheet" media="screen">
    
</head>
<body>

<div class="header">
    <div class="header-content">
        <div class="brand"><a href="/"><img class="logo" src="/node-red.png" /> Node-RED User Group Japan</a></div>
        <ul class="navigation">
            <li ><a href="/">ホーム</a></li>
            <li><a href="https://blog.nodered.org/" target="_blank">ブログ</a></li>
            <li class="current"><a href="/docs/">ドキュメント</a></li>
            <li><a href="https://flows.nodered.org/" target="_blank">flows</a></li>
            <li><a href="https://github.com/node-red/node-red" target="_blank">github</a></li>
        </ul>
        <a href="#" class="menu"><i class="icon-reorder icon-2x"></i></a>
    </div>
</div>

<div class="docs">
  <div class="grid">
    <div class="col-3-12">
    <ul class="toc">
    <li class="toc-expander"><div>V</div></li>
    <li class="tocheader"><span>ドキュメント</span>
        <ul>
            <li ><a href="/docs/">概要</a>
        </ul>
    </li>
    <li class="tocheader"><span>Getting Started</span>
        <ul>
            <li ><a href="/docs/getting-started/installation">インストール</a>
            <li ><a href="/docs/getting-started/running">起動  </a>
            <li ><a href="/docs/getting-started/adding-nodes">Nodeの追加</a>
            <li ><a href="/docs/getting-started/upgrading">アップグレード</a>
            <li ><a href="/docs/getting-started/first-flow">はじめてのFlow</a>
            <li ><a href="/docs/getting-started/second-flow">Flow作成</a>
        </ul>
    </li>
    <li class="tocheader"><span>Node-REDの利用</span>
        <ul>
            <li ><a href="/docs/configuration">設定</a></li>
            <li ><a href="/docs/security">認証</a></li>
            <li ><a href="/docs/node-red-admin">Adminツール</a></li>
            <li ><a href="/docs/writing-functions">Function Nodeの書き方</a></li>
            <li ><a href="/docs/embedding">既存アプリケーションへの組込み</a></li>
        </ul>
    </li>
    <li class="tocheader"><span>プラットフォーム</span>
        <ul>
        <li class="tocsubheader"><span>デバイス</span></li>
            <li ><a href="/docs/hardware/raspberrypi">Raspberry Pi</a>
            <li ><a href="/docs/hardware/beagleboneblack">BeagleBone Black</a>
        <li class="tocsubheader"><span>クラウド</span></li>
            <li ><a href="/docs/platforms/bluemix">IBM Bluemix</a>
            <li ><a href="/docs/platforms/aws">Amazon Web Services</a>
            <li ><a href="/docs/platforms/azure">Microsoft Azure</a>
        <li class="tocsubheader"><span>その他</span></li>
            <li ><a href="/docs/hardware/arduino">Arduino</a>
            <li ><a href="/docs/platforms/docker">Docker</a>
        </ul>
    </li>
    <li class="tocheader"><span>API</span>
        <ul>
            <li><a href="/docs/api/">概要</a>
        </ul>
    </li>
    <li class="tocheader"><span>Nodeの作成</span>
        <ul>
            <li ><a href="/docs/creating-nodes/">概要</a></li>
            <li ><a href="/docs/creating-nodes/first-node">Node作成</a></li>
            <li ><a href="/docs/creating-nodes/node-js">JavaScriptファイル</a>
            <li ><a href="/docs/creating-nodes/node-html">HTMLファイル</a>
            <li ><a href="/docs/creating-nodes/context">コンテキスト</a></li>
            <li ><a href="/docs/creating-nodes/properties">プロパティ</a></li>
            <li ><a href="/docs/creating-nodes/credentials">クレデンシャル</a></li>
            <li ><a href="/docs/creating-nodes/appearance">UI</a></li>
            <li ><a href="/docs/creating-nodes/status">ステータス</a></li>
            <li ><a href="/docs/creating-nodes/config-nodes">設定</a></li>
            <li ><a href="/docs/creating-nodes/packaging">パッケージング</a></li>
            <li ><a href="/docs/creating-nodes/i18n">国際化</a></li>
        </ul>
    </li>
</ul>

<script>
$(function() {
    $(".toc-expander").click(function() {
        if ($("ul.toc").hasClass('open')) {
            $("ul.toc").removeClass('open');
        } else {
            $("ul.toc").addClass('open');
        }
    })
});
//$(function() {
//    $("li.tocheader ul").hide();
//    $("li.tocheader a.active").parent().parent().show();
//    $("li.tocheader>span").click(function(e) {
//        $(this).next().toggle("fast");
//    });
//});
</script>

    </div>
    <div class="col-9-12">
      <div class="docs-content">
        <h1 class="docs-title">Running under Docker</h1>
        <p>There are many ways you could choose to run Node-RED under Docker. This guide
describe some of the ways you can do it.</p>

<p>It assumes you have some basic familiarity with Docker and the
<a href="https://docs.docker.com/reference/commandline/cli/">Docker Command Line</a>.</p>

<h3 id="container-versions">Container versions</h3>

<p>We publish three tagged versions of the container to <a href="https://hub.docker.com/r/nodered/node-red-docker/">DockerHub</a>:</p>

<ul>
  <li><code class="highlighter-rouge">latest</code> - uses <a href="https://hub.docker.com/_/node/">official Node.JS v4 base image</a>.</li>
  <li><code class="highlighter-rouge">slim</code> - uses <a href="https://hub.docker.com/r/mhart/alpine-node/">Alpine Linux base image</a>.</li>
  <li><code class="highlighter-rouge">rpi</code> - uses <a href="https://hub.docker.com/r/hypriot/rpi-node/">RPi-compatible base image</a>.</li>
</ul>

<p>Using Alpine Linux reduces the built image size (~100MB vs ~700MB) but removes
standard dependencies that are required for native module compilation. If you
want to add modules with native dependencies, use the standard image or extend
the slim image with the missing packages.</p>

<h3 id="quick-start">Quick start</h3>

<p>To run the <code class="highlighter-rouge">latest</code> container:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>docker run -it -p 1880:1880 --name mynodered nodered/node-red-docker
</code></pre>
</div>

<p>This command will download the <code class="highlighter-rouge">nodered/node-red-docker</code> container from DockerHub
and run an instance of it with the name of <code class="highlighter-rouge">mynodered</code> and with port 1880 exposed.
In the terminal window you will see Node-RED start. Once started you can then
browse to <code class="highlighter-rouge">http://{host-ip}:1880</code> to access the editor.</p>

<p>Hit <code class="highlighter-rouge">Ctrl-p</code> <code class="highlighter-rouge">Ctrl-q</code> to detach from the container. This leaves it running in the
background.</p>

<p>To reattach to the container:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>docker attach mynodered
</code></pre>
</div>

<p>To stop the container:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>docker stop mynodered
</code></pre>
</div>

<p>To start the container:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>docker start mynodered
</code></pre>
</div>

<div class="doc-callout">
<p><em>Note</em>: your flows will be stored in the file called <code>flows.json</code>
within the container. This can be customised by setting the <code>FLOWS</code>
environment parameter:
</p>
<pre>docker run -it -p 1880:1880 -e FLOWS=my_flows.json nodered/node-red-docker</pre>
<p>Node.js runtime arguments can be passed to the container using an environment parameter (<code>NODE_OPTIONS</code>). For example, to fix the heap size used by the Node.js garbage collector you would use the following command:
</p>
<pre>docker run -it -p 1880:1880 -e NODE_OPTIONS="--max_old_space_size=128" nodered/node-red-docker</pre>
</div>

<h3 id="customising">Customising</h3>

<p>The container uses the directory <code class="highlighter-rouge">/data</code> as the user configuration directory. To
add additional nodes you can open shell into the container and run the appropriate
<code class="highlighter-rouge">npm install</code> commands:</p>

<div class="highlighter-rouge"><pre class="highlight"><code># Open a shell in the container
docker exec -it mynodered /bin/bash

# Once inside the container, npm install the nodes in /data
cd /data
npm install node-red-node-smooth
exit

# Restart the container to load the new nodes
docker stop mynodered
docker start mynodered
</code></pre>
</div>

<h3 id="storing-data-outside-of-the-container">Storing data outside of the container</h3>

<p>It is possible to mount the <code class="highlighter-rouge">/data</code> path on an external volume:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>docker run -it -p 1880:1880 -v ~/node-red-data:/data --name mynodered nodered/node-red-docker
</code></pre>
</div>

<p>This command mounts the host’s <code class="highlighter-rouge">~/node-red-data</code> directory as the user configuration directory inside the container.</p>

<p>Adding extra nodes to the container can then be accomplished by running <code class="highlighter-rouge">npm install</code>
on the host machine:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>cd ~/node-red-data
npm install node-red-node-smooth
docker stop mynodered
docker start mynodered
</code></pre>
</div>

<div class="doc-callout">
<p><em>Note</em>: Modules with a native dependencies will be compiled on the host
machine's architecture. These modules will not work inside the Node-RED
container unless the architecture matches the container's base image. For native
modules, it is recommended to install using a local shell or update the
package.json and re-build.</p></div>

<h3 id="building-the-container-from-source">Building the container from source</h3>

<p>The Dockerfiles for these containers are maintained <a href="https://github.com/node-red/node-red-docker">here</a>, each under its own branch.</p>

<p>To build your own version:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>git clone https://github.com/node-red/node-red-docker.git
cd node-red-docker

# Build it with the desired tag
docker build -f &lt;version&gt;/Dockerfile -t mynodered:&lt;tag&gt; .
</code></pre>
</div>

<h3 id="building-a-custom-image">Building a custom image</h3>

<p>Creating a new Docker image, using the public Node-RED images as the base image,
allows you to install extra nodes during the build process.</p>

<ol>
  <li>
    <p>Create a file called <code class="highlighter-rouge">Dockerfile</code> with the content:</p>

    <div class="highlighter-rouge"><pre class="highlight"><code> FROM nodered/node-red-docker
 RUN npm install node-red-node-wordpos
</code></pre>
    </div>
  </li>
  <li>
    <p>Run the following command to build the image:</p>

    <div class="highlighter-rouge"><pre class="highlight"><code> docker build -t mynodered:&lt;tag&gt; .
</code></pre>
    </div>
  </li>
</ol>

<p>That will create a Node-RED image that includes the <code class="highlighter-rouge">wordpos</code> nodes.</p>

<h3 id="updating">Updating</h3>

<p>Updating the base container image is as simple as</p>

<div class="highlighter-rouge"><pre class="highlight"><code>docker pull nodered/node-red-docker
docker stop mynodered
docker start mynodered
</code></pre>
</div>

<h3 id="linking-containers">Linking Containers</h3>

<p>You can link containers “internally” within the Docker runtime by using the
<code class="highlighter-rouge">--link</code> option.</p>

<p>For example, if you have a container that provides an MQTT broker container called <code class="highlighter-rouge">mybroker</code>, you can run the Node-RED container with the <code class="highlighter-rouge">link</code> parameter to join the
two:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>docker run -it -p 1880:1880 --name mynodered --link mybroker:broker nodered/node-red-docker
</code></pre>
</div>

<p>This will make <code class="highlighter-rouge">broker</code> a known hostname within the Node-RED container that can be
used to access the service within a flow, without having to expose it outside
of the Docker host.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>[{"id":"190c0df7.e6f3f2","type":"mqtt-broker","broker":"broker","port":"1883","clientid":""},{"id":"37963300.c869cc","type":"mqtt in","name":"","topic":"test","broker":"190c0df7.e6f3f2","x":226,"y":244,"z":"f34f9922.0cb068","wires":[["802d92f9.7fd27"]]},{"id":"edad4162.1252c","type":"mqtt out","name":"","topic":"test","qos":"","retain":"","broker":"190c0df7.e6f3f2","x":453,"y":135,"z":"f34f9922.0cb068","wires":[]},{"id":"13d1cf31.ec2e31","type":"inject","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":226,"y":157,"z":"f34f9922.0cb068","wires":[["edad4162.1252c"]]},{"id":"802d92f9.7fd27","type":"debug","name":"","active":true,"console":"false","complete":"false","x":441,"y":261,"z":"f34f9922.0cb068","wires":[]}]
</code></pre>
</div>

      </div>
    </div>
  </div>
</div>

<div class="footer">
    <div class="grid">
        <div class="content">
            <a class="link-icon" href="http://github.com/node-red/node-red"><i class="icon-github icon-2x"></i></a>
            <a class="link-icon" href="http://twitter.com/nodered"><i class="icon-twitter icon-2x"></i></a>
            <a class="link-icon" href="https://groups.google.com/forum/#!forum/node-red"><i class="icon-envelope icon-2x"></i></a>
            <a class="link-icon" href="http://blog.nodered.org/rss"><i class="icon-rss icon-2x"></i></a>
            <div class="ets-link"><a href="http://ibm.com/blogs/et">Node-RED is a creation of IBM Emerging Technology</a></div>
            <div class="ets-link"><a href="http://ibm.com/blogs/et"><img class="ets-globe" src="/images/ets-globe.png" /> </a></div>
        </div>
    </div>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-43773533-1', 'auto');
  ga('send', 'pageview');

  $(function() {
    $(".menu").click(function(e) {
        var s = $(".navigation").slideToggle('hide');
        e.preventDefault();
    });
  });
</script>
</body>
</html>

