<!DOCTYPE html>
<html lang="ja"><head>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Node-RED日本ユーザ会  : JavaScript file</title>

	<link href='https://fonts.googleapis.com/css?family=Roboto+Slab:400,700,300,100' rel='stylesheet' type='text/css'>
	<link href='https://fonts.googleapis.com/css?family=Ubuntu+Mono' rel='stylesheet' type='text/css'>
	<link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">

    <script src="/jquery/js/jquery-1.9.1.js"></script>
	<link href="/css/simplegrid.css" rel="stylesheet" media="screen">
	<link href="/css/style.css" rel="stylesheet" media="screen">
	<link href="/css/front.css" rel="stylesheet" media="screen">
	<link href="/css/docs.css" rel="stylesheet" media="screen">
	<link href="/css/blog.css" rel="stylesheet" media="screen">
	<link href="/css/syntax.css" rel="stylesheet" media="screen">
    
</head>
<body>

<div class="header">
    <div class="header-content">
        <div class="brand"><a href="/"><img class="logo" src="/node-red.png" /> Node-RED User Group Japan</a></div>
        <ul class="navigation">
            <li ><a href="/">ホーム</a></li>
            <li><a href="https://blog.nodered.org/" target="_blank">ブログ</a></li>
            <li class="current"><a href="/docs/">ドキュメント</a></li>
            <li><a href="https://flows.nodered.org/" target="_blank">flows</a></li>
            <li><a href="https://github.com/node-red/node-red" target="_blank">github</a></li>
        </ul>
        <a href="#" class="menu"><i class="icon-reorder icon-2x"></i></a>
    </div>
</div>

<div class="docs">
  <div class="grid">
    <div class="col-3-12">
    <ul class="toc">
    <li class="toc-expander"><div>V</div></li>
    <li class="tocheader"><span>ドキュメント</span>
        <ul>
            <li ><a href="/docs/">概要</a>
        </ul>
    </li>
    <li class="tocheader"><span>Getting Started</span>
        <ul>
            <li ><a href="/docs/getting-started/installation">インストール</a>
            <li ><a href="/docs/getting-started/running">起動  </a>
            <li ><a href="/docs/getting-started/adding-nodes">Nodeの追加</a>
            <li ><a href="/docs/getting-started/upgrading">アップグレード</a>
            <li ><a href="/docs/getting-started/first-flow">はじめてのFlow</a>
            <li ><a href="/docs/getting-started/second-flow">Flow作成</a>
        </ul>
    </li>
    <li class="tocheader"><span>Node-REDの利用</span>
        <ul>
            <li ><a href="/docs/configuration">設定</a></li>
            <li ><a href="/docs/security">認証</a></li>
            <li ><a href="/docs/node-red-admin">Adminツール</a></li>
            <li ><a href="/docs/writing-functions">Function Nodeの書き方</a></li>
            <li ><a href="/docs/embedding">既存アプリケーションへの組込み</a></li>
        </ul>
    </li>
    <li class="tocheader"><span>プラットフォーム</span>
        <ul>
        <li class="tocsubheader"><span>デバイス</span></li>
            <li ><a href="/docs/hardware/raspberrypi">Raspberry Pi</a>
            <li ><a href="/docs/hardware/beagleboneblack">BeagleBone Black</a>
        <li class="tocsubheader"><span>クラウド</span></li>
            <li ><a href="/docs/platforms/bluemix">IBM Bluemix</a>
            <li ><a href="/docs/platforms/aws">Amazon Web Services</a>
            <li ><a href="/docs/platforms/azure">Microsoft Azure</a>
        <li class="tocsubheader"><span>その他</span></li>
            <li ><a href="/docs/hardware/arduino">Arduino</a>
            <li ><a href="/docs/platforms/docker">Docker</a>
        </ul>
    </li>
    <li class="tocheader"><span>API</span>
        <ul>
            <li><a href="/docs/api/">概要</a>
        </ul>
    </li>
    <li class="tocheader"><span>Nodeの作成</span>
        <ul>
            <li ><a href="/docs/creating-nodes/">概要</a></li>
            <li ><a href="/docs/creating-nodes/first-node">Node作成</a></li>
            <li ><a href="/docs/creating-nodes/node-js">JavaScriptファイル</a>
            <li ><a href="/docs/creating-nodes/node-html">HTMLファイル</a>
            <li ><a href="/docs/creating-nodes/context">コンテキスト</a></li>
            <li ><a href="/docs/creating-nodes/properties">プロパティ</a></li>
            <li ><a href="/docs/creating-nodes/credentials">クレデンシャル</a></li>
            <li ><a href="/docs/creating-nodes/appearance">UI</a></li>
            <li ><a href="/docs/creating-nodes/status">ステータス</a></li>
            <li ><a href="/docs/creating-nodes/config-nodes">設定</a></li>
            <li ><a href="/docs/creating-nodes/packaging">パッケージング</a></li>
            <li ><a href="/docs/creating-nodes/i18n">国際化</a></li>
        </ul>
    </li>
</ul>

<script>
$(function() {
    $(".toc-expander").click(function() {
        if ($("ul.toc").hasClass('open')) {
            $("ul.toc").removeClass('open');
        } else {
            $("ul.toc").addClass('open');
        }
    })
});
//$(function() {
//    $("li.tocheader ul").hide();
//    $("li.tocheader a.active").parent().parent().show();
//    $("li.tocheader>span").click(function(e) {
//        $(this).next().toggle("fast");
//    });
//});
</script>

    </div>
    <div class="col-9-12">
      <div class="docs-content">
        <h1 class="docs-title">JavaScript file</h1>
        <p>The node <code class="highlighter-rouge">.js</code> file defines the runtime behaviour of the node.</p>

<h3 id="node-constructor">Node constructor</h3>

<p>Nodes are defined by a constructor function that can be used to create new instances
of the node. The function gets registered with the runtime so it can be called
when nodes of the corresponding type are deployed in a flow.</p>

<p>The function is passed an object containing the properties set in the flow editor.</p>

<p>The first thing it must do is call the <code class="highlighter-rouge">RED.nodes.createNode</code> function to initialise
the features shared by all nodes. After that, the node-specific code lives.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">SampleNode</span><span class="p">(</span><span class="nx">config</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">RED</span><span class="p">.</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">createNode</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">config</span><span class="p">);</span>
    <span class="c1">// node-specific code goes here</span>
        
<span class="p">}</span>

<span class="nx">RED</span><span class="p">.</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">registerType</span><span class="p">(</span><span class="s2">"sample"</span><span class="p">,</span><span class="nx">SampleNode</span><span class="p">);</span></code></pre></figure>

<h3 id="receiving-messages">Receiving messages</h3>

<p>Nodes register a listener on the <code class="highlighter-rouge">input</code> event to receive messages from the
up-stream nodes in a flow.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'input'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// do something with 'msg'</span>
<span class="p">});</span></code></pre></figure>

<h3 id="sending-messages">Sending messages</h3>

<p>Nodes can send messages to the down-stream nodes in a flow using the <code class="highlighter-rouge">send</code> function:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">msg</span> <span class="o">=</span> <span class="p">{</span> <span class="na">payload</span><span class="p">:</span><span class="s2">"hi"</span> <span class="p">}</span>
<span class="k">this</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span></code></pre></figure>

<p>If <code class="highlighter-rouge">msg</code> is null, no message is sent.</p>

<h4 id="multiple-outputs">Multiple outputs</h4>

<p>If the node has more than one output, an array of messages can be passed to <code class="highlighter-rouge">send</code>, with
each one being sent to the corresponding output.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">this</span><span class="p">.</span><span class="nx">send</span><span class="p">([</span> <span class="nx">msg1</span> <span class="p">,</span> <span class="nx">msg2</span> <span class="p">]);</span></code></pre></figure>

<h4 id="multiple-messages">Multiple messages</h4>

<p>It is possible to send multiple messages to a particular output by passing an array
of messages within this array:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">this</span><span class="p">.</span><span class="nx">send</span><span class="p">([</span> <span class="p">[</span><span class="nx">msgA1</span> <span class="p">,</span> <span class="nx">msgA2</span> <span class="p">,</span> <span class="nx">msgA3</span><span class="p">]</span> <span class="p">,</span> <span class="nx">msg2</span> <span class="p">]);</span></code></pre></figure>

<h3 id="closing-the-node">Closing the node</h3>

<p>Whenever a new flow is deployed, the existing nodes are deleted. If any of them
need to tidy up state when this happens, such as disconnecting
from a remote system, they should register a listener on the <code class="highlighter-rouge">close</code> event.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'close'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// tidy up any state</span>
<span class="p">});</span></code></pre></figure>

<p>If the node needs to do any asynchronous work to complete the tidy up, the
registered listener should accept an argument which is a function to be called
when all the work is complete.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'close'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">doSomethingWithACallback</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">done</span><span class="p">();</span>
    <span class="p">});</span>
<span class="p">});</span></code></pre></figure>

<h3 id="logging-events">Logging events</h3>

<p>If a node needs to log something to the console, it can use one of the follow functions:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Something happened"</span><span class="p">);</span>
<span class="k">this</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s2">"Something happened you should know about"</span><span class="p">);</span>
<span class="k">this</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">"Oh no, something bad happened"</span><span class="p">);</span></code></pre></figure>

<p>The <code class="highlighter-rouge">warn</code> and <code class="highlighter-rouge">error</code> messages also get sent to the flow editor debug tab.</p>

<h4 id="handling-errors">Handling errors</h4>

<p>If the node encounters an error that should halt the current flow, it should log
the event with the <code class="highlighter-rouge">this.error</code> function.</p>

<p>If the error is one that a user of the node may want to handle for themselves,
the function should be called with the original message (or an empty message if
this is an Input node) as the second argument:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">node</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">"hit an error"</span><span class="p">,</span> <span class="nx">msg</span><span class="p">);</span></code></pre></figure>

<p>This will trigger any Catch nodes present on the same tab.</p>

<h3 id="setting-status">Setting status</h3>

<p>Whilst running, a node is able to share status information with the editor UI.
This is done by calling the <code class="highlighter-rouge">status</code> function:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">this</span><span class="p">.</span><span class="nx">status</span><span class="p">({</span><span class="na">fill</span><span class="p">:</span><span class="s2">"red"</span><span class="p">,</span><span class="na">shape</span><span class="p">:</span><span class="s2">"ring"</span><span class="p">,</span><span class="na">text</span><span class="p">:</span><span class="s2">"disconnected"</span><span class="p">});</span></code></pre></figure>

<p>The details of the status api can be found <a href="status.html">here</a>.</p>


      </div>
    </div>
  </div>
</div>

<div class="footer">
    <div class="grid">
        <div class="content">
            <a class="link-icon" href="http://github.com/node-red/node-red"><i class="icon-github icon-2x"></i></a>
            <a class="link-icon" href="http://twitter.com/nodered"><i class="icon-twitter icon-2x"></i></a>
            <a class="link-icon" href="https://groups.google.com/forum/#!forum/node-red"><i class="icon-envelope icon-2x"></i></a>
            <a class="link-icon" href="http://blog.nodered.org/rss"><i class="icon-rss icon-2x"></i></a>
            <div class="ets-link"><a href="http://ibm.com/blogs/et">Node-RED is a creation of IBM Emerging Technology</a></div>
            <div class="ets-link"><a href="http://ibm.com/blogs/et"><img class="ets-globe" src="/images/ets-globe.png" /> </a></div>
        </div>
    </div>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-43773533-1', 'auto');
  ga('send', 'pageview');

  $(function() {
    $(".menu").click(function(e) {
        var s = $(".navigation").slideToggle('hide');
        e.preventDefault();
    });
  });
</script>
</body>
</html>

